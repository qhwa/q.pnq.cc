
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>qhwa's blog</title>
	<meta name="author" content="qhwa">

	
	<meta name="description" content="暖气片的故事 谢天谢地，这几天北京终于开始供暖气啦！从寒冷的室外，打开一扇门，就可以回到温暖的家，这是南方人的我最喜欢北京的地方了。在温暖的房间里，把厚被子换成薄被子，感觉再也不用瑟瑟发抖了。 走进次卧的瞬间，我就感觉到了一丝凉意。难道暖气片坏了？摸了一摸，发现没有热气。这可不行，次卧是 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="qhwa's blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">qhwa's blog</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:q.pnq.cc">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
		<a class="github" href="https://github.com/qhwa" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:q.pnq.cc">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2018/11/14/scientific-thinking/">
		
			次卧暖气片的故事和科学思维</a>
	</h2>
	<div class="entry-content">
		<h2>暖气片的故事</h2>

<p>谢天谢地，这几天北京终于开始供暖气啦！从寒冷的室外，打开一扇门，就可以回到温暖的家，这是南方人的我最喜欢北京的地方了。在温暖的房间里，把厚被子换成薄被子，感觉再也不用瑟瑟发抖了。</p>

<p>走进次卧的瞬间，我就感觉到了一丝凉意。难道暖气片坏了？摸了一摸，发现没有热气。这可不行，次卧是 Jojo 和阿姨睡觉的地方，难怪 Jojo 这几天手脚冰冷的，也没睡好。</p>

<p>「打电话给暖气公司报修一下吧！」这是我的第一反应。但是阿姨阻止了我：「不用的，我以前也遇到过，热的比较慢，过一个星期就好了」。
「是吗？」有可能哦，可能就是这么设计的？让暖气慢慢热透整个暖气片？那就过几天再看看吧！</p>

<p>第二天，我又到次卧。还是一样的冷。不过暖气片有进步，热了两片，上次才一片。看来阿姨说的慢慢热起来，也是真的。
第三天的时候，还是冷，暖气片还只热了两片。</p>

<p>「到底是怎么回事呢？」
——「就是这样的，过一星期就好了。」
「那是为什么呢？为什么比别的房间慢呢？」
——「有的暖气片就是这样的。」</p>

<p>emmmm，总有个原因的吧？</p>

<p>我决定在网上查一下。打开 Google ，输入「暖气片只有几片热」，按下回车。
果然，有人也遇到同样的问题！据说是因为暖气片里面有空气，打开排气阀，排掉就好了。Soga!</p>

<p>我有心理准备，这个暖气片不是好对付的。白色喷漆覆盖了整个暖气片。我小心翼翼地刮开排气阀上的漆，让他露出来。果然不是省油的灯，螺丝盖已经成了一个圆形，拧了半天纹丝不动。我只好用一个老虎钳死死夹住唯一有点平的一处，用蛮力去转。突然「咝——」的一声，空气出来了！太棒啦！不一会儿，水汽也跟着出来了。等到水往下滴的时候，我拧回了螺丝。</p>

<p>接下来就是检验成果的时候了，已经没有什么悬念：暖气片慢慢地热起来了，三片、四片……慢慢就热起来了。带着工具和骄傲，我开心地离开了次卧。</p>

<h2>科学思维</h2>

<p>多年的职业生涯，训练了我很多习惯。其中一个是「科学思维」：</p>

<p><strong>如果一个问题，我们不知道背后的原因，说明我们对她还没有的正确认知。</strong></p>

<p><strong>在没有正确认知的情况下去解决问题，会事倍功半，甚至无功而返。</strong></p>

<p>很多人遇到小宝宝哭，不分状况就抱起来晃，或者抱着到处走，转移注意力。这可以作为安抚的方法先应用，但倘若不去细听哭声的层次，对哭声背后的需求不去探究，这些临时的安抚措施往往都会失效，小宝宝会因为需求得不到满足而感到沮丧，哭得更厉害。</p>

<p><strong>盲目去解决问题而不去探索原因，对我们自己的成长没有益处，有可能还是有害的。</strong></p>

<p>我的工作 —— 程序员 —— 主要的工作内容就是解决问题。大家每天都在解决问题，但是不同的人成长速度还是不一样。成长快的人，解决问题的时候会想方设法了解问题产生的原因，从一个点切入，了解整个系统的知识。</p>

<p>说到这里，我就想起了另外一个故事。</p>

<h2>瓷器的故事</h2>

<p>我们日常生活中经常用到瓷器，我们都知道 China 既是中国也是瓷器。瓷器硬度、光滑度都不错，中国历代都不断改良，明朝时达到巅峰。然而大部分人包括我以前，都不知道，其实现代的瓷器却不是中国人发明的。中国的瓷器传承几百年，有一些工艺的沉淀，依照一定的方式去制作，就有可能做出好的瓷器。但成品率一直很低。即便在清朝供应宫廷使用的官窑，也很难保证产量。在以前，家里有瓷器的非富即贵。欧洲皇室疯狂追求瓷器，只能向中国进口。而我们今天，谁家里没有几个瓷碗呢？</p>

<p>瓷器的工艺一直都作为商业机密口口相传，限制在小范围内。传递过程中越来越玄学了，有些做法不知道原因，但是就是管用。比如周杰伦的《青花瓷》唱道「天青色等烟雨」，指的是天将雨未雨的时候，此时最适合制作青花瓷，但是不是空气湿度的原因？我们不知道，照做就行，等着这样的天气吧。</p>

<p>中国垄断了近千年的瓷器，产生了巨额的利益。欧洲人也希望能掌握这样的技术，用尽各种方法试图破解瓷器的秘密，其中以德国的故事最为曲折。</p>

<p>理性而执拗的德国人信赖科技兴邦，但在破译瓷器密码这件事儿上，他们依靠的是王权、科学和颇带投机色彩的炼金术士三位一体的强力组合。</p>

<p>1694年，奥古斯都王子即位成为萨克森选帝侯。奥古斯都恋瓷成癖，他拥有的瓷器达到35,798件，是西方世界最大规模的瓷器收藏。他批量购买康熙瓷，购买大盖罐、瓷盘、花瓶，总之就是景德镇生产的一切器物。当然了，都是通过荷兰的东印度公司购买的，付钱如流水。</p>

<p>当时德国有个哲学家、数学家——契恩豪斯。对他来说，瓷器是个值得认真研究的课题：白瓷不是天然存在的物质，需要经过化学反应的淬炼（这个神奇过程的奥秘已让无数英雄在实验室中折戟），而最终成型的这种坚硬的白色固体，居然可以让光穿透。契恩豪斯是个务实的人，他花了二十年时间观察玻璃作坊和彩陶工厂的操作，见识过那些配制、提炼和做化验检测的人。作为一个数学家，他能够看到规律如何呈现；也懂得钻研问题需要花时间，测试各种可能的排列组合。在国王的实验室，契恩豪斯日复一日锲而不舍地测试和研制瓷的配方。投入试验的矿物质价格不菲，打开窑炉和坩埚，只见又是一块烧结的疙瘩，又一个妙点子化为硬邦邦的废物，这种生活一定十分煎熬。他工作非常刻苦，每天站在巨大的燃烧镜前检测矿物质，毁掉了他的视力。</p>

<p>多次失败之后，契恩豪斯遇到了国王的炼金师波特格。波特格19岁时“在可靠的目击证人面前炼成了黄金”，自那之后争夺这个男孩的人“比争夺特洛伊美女海伦的人还要多”。他从柏林逃到了萨克森，在激烈的挣扎后被逮捕，随后被奥古斯都秘密关押。波特格没能给国王炼出金子，但契恩豪斯察觉到这个年轻的术士身上有一种化学的悟性，对物质具有直觉的感受力，也会走捷径。</p>

<p>数学家与炼金术士一起在“宛如地狱”的地下室工作了六年。温度高达几千摄氏度的灼热窑炉是个巨大的潜在危险。“他们每隔半个小时就看一下窑炉，像看护牲口似的，红红的火光让人赶紧跳开。里面太热了，他们的头发被烧焦，地板滚烫，他们脚上起了大水泡。”波特格活像“扫烟囱的人”，他的脑袋上缠着打湿的破布条。</p>

<p>在现存的波特格笔记本的一页上记载着1708年1月一次实验的情况，这次烧制测试了七种配方，按照不同的比例把某地出产的一种白色黏土与雪花石膏混合起来，每种编号下标明了具体的配比。德国人在严谨的反复实验上加乘了两倍甚至三倍于常人的努力，终于将想法变成现实。</p>

<p>1708年4月，奥古斯都签署法令并加盖印章，在德累斯顿建立了第一座瓷厂，这也是西方第一座瓷器制造厂。10月9日，契恩豪斯和波特格烧造了第一只真正的无釉瓷杯，第一只半透明白色器皿。德国至此在西方世界率先破解了秘术的玄机，拥有了制作瓷器的知识。这种全新的白色物质被称为Böttgerporzellan，“波特格瓷”。 德国人在麦森兴建了一座新工厂，生产由秘术师波特格发明的白瓷。麦森瓷成为御用精品，三百年来历久不衰且愈发精美贵重，至今依然是蜚声国际的顶级名瓷。</p>

<p>欧洲人擅长定量分析和比较试验，并且注重保留全部原始数据和实验报告，不仅代表了实验的严谨性，也能让后续人不用重新造车而直接受益。
目前欧洲人占据高端瓷器市场的 90%，其余被美国和日本瓜分，不仅令人唏嘘。</p>

<p><strong>承认自己的无知，尊重实验，寻找规律，构成了科学思维。</strong></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2018-11-14T11:08:28+08:00" pubdate data-updated="true">Nov 14<span>th</span>, 2018</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2018/08/10/cong-xin-shou-dao-zhuan-jia-ji-neng-cheng-chang-mo-xing/">
		
			从新手到专家——技能成长模型</a>
	</h2>
	<div class="entry-content">
		<h2>专家的特征</h2>

<p>2009年1月15日，Sullenberger (也叫萨利) 在全美航空1549号班担任机长，飞机从纽约拉瓜迪亚机场起飞。五分钟后，在爬升过程中遭到飞鸟撞击，两架发动机全部熄火。此时只能就近寻求迫降，但高度不够，在没有动力的情况下，很难抵达附近的机场，如果处置不当，也很容易引起地面的巨大伤亡。危急时刻，萨利决定在哈德逊河上迫降，155人 <strong>全数生还</strong>。</p>

<p><img src="https://pic3.zhimg.com/80/v2-eb487300ceb2fa1bd92effbee5f1962e_hd.jpg" alt="aircraft crash" /></p>

<p>从起飞到迫降，短短六分钟。萨利凭借自己的经验、技术和准确的判断，拯救了机上所有人的生命。电影《萨利机长》还原了整个过程。在感慨紧张的英雄事迹之余，我们有幸看到一位真正的飞行专家是怎样行事的。</p>

<h3>1</h3>

<p>失去动力之后，仪表显示发动机损坏一个，另一个处于正常状态。然而萨利根据声音、气味等细节，确定是鸟袭，并且断定两个引擎均已损坏。这个判断非常关键，直接关系到是否能及时返航。如果还有动力，就可以回到拉瓜迪亚机场了。 <strong>专家重视细节，不盲从二手信息。</strong></p>

<h3>2</h3>

<p>确定动力失灵后，萨利立即下意识地打开了辅助动力系统 (APU) ，然后让副机长杰夫拿出飞行手册，按手册指引操作。依据飞行手册，出现飞鸟撞击事故时，其中第15步是打开 APU，然而萨利却直接跳过了前面的步骤，直接打开 APU。如果没有 启动 APU，飞机将不能顺利滑翔。没有这一举动，迫降就不可能成功。此外，手册有三页长，到迫降时也只进行了一页半。如果完全遵循手册逐条进行，恐怕结局已经是机毁人亡了。<strong>专家重视情境，不盲从流程。流程甚至会阻碍专家行事。</strong></p>

<h3>3</h3>

<p>与塔台沟通后，飞机掉头返航。塔台清除了机场的跑道提供迫降，但萨利回复道「unable」，因为此时飞机动力不足，是无法抵达出发机场的。随后塔台安排了附近另一个机场。返航过程中，萨利意识到仍然无法抵达动，只能迫降在水面上了，于是当机立断，迫降到哈德逊河上。不了解航空史的人可能不知道，水面迫降是几乎不可能成功的。在此之前，还没有大型客机水面迫降成功的案例。萨利机长在事后接受采访时，提到自己有非常大的把握能控制飞机，确信自己能做到水面降落。这样的自信，需要丰富的知识、经验。这离不开萨利机长的成长经历。</p>

<p>萨利 5 岁就知道自己想做一个飞行员，11 岁就读了所有能找到的跟飞行有关的书。16岁，萨利就跟着一个开农用飞机的驾驶员库克学习。之后萨利在美国空军学院学习了驾驶滑翔机，并在空军服役。退役后，他加入了太平洋西南航空（后并入美国航空）担任民航飞行员。在2009年的时候，他已经差不多有30年的民航驾驶经验了。滑翔机的学习经验非常重要，飞机在高空失去动力，也就相当于一架十几吨重的滑翔机。无独有偶，史上最成功的几次迫降事件，驾驶员都有滑翔机驾驶经验。 <strong>专家有丰富的知识积累。</strong></p>

<h3>4</h3>

<p>萨利本身也是 NTSB （美国航空安全委员会）的调查员，在 2009 年之前就协助 NTSB 调查航空事故，访问空难家属。同时，他还会收集各种飞行事故的调查报告。这些研究对这次的迫降非常重要。飞机要在水上迫降成功，需要几个要点：</p>

<ul>
<li>水上迫降时应收起起落架</li>
<li>飞机近水时的速度越小越好</li>
<li>机翼的襟翼应在水下位置接水更有利</li>
</ul>


<p>这些知识，正是从之前的空难调查报告中总结出来的。在这次事件中，帮助萨利做了正确的选择。<strong>专家会不断反思，从(自己或他人的)不足中总结。</strong></p>

<h3>5</h3>

<blockquote><p>我必须压抑本能的激动反应，来挽救机上的每一条人命。我很快思考各种可能性，然后选择唯一的可行方案。—— 萨利</p></blockquote>

<p>除了大量的知识储备，危急关头的冷静和直觉，让萨利得以快速反应，在短时间内做出正确选择。 <strong>专家依赖直觉。</strong></p>

<p>飞行当然是一种技能。但技能在我们的生活、工作中无处不在。 我们的生活中需要各种各样的技能，例如做饭，与人沟通，写程序，养育小孩等等。这些事情都需要我们具备一定的知识，并有运用这些知识的技巧。以编程为例，作为一个程序员，首先要学会产品经理的语言，能读懂需求文档，知道常见的一些需求实现方案，并将已知的方案组合，实现产品的需求；其次要学会计算机的语言，将方案转化成计算机程序，并且要留意工程性，写出代码还需要关注可维护性和性能。</p>

<p>三百六十行，行行出状元。总有一些大师、专家涌现在我们的视野中。即便没有那么遥远，我们的身边也不乏一些更会做菜的朋友、更会和宝宝交流的爸爸妈妈。他们是如何成长的？他们的成长经历了哪些阶段，不同的阶段又是如何跨越的呢？</p>

<h2>技能提升的五个阶段</h2>

<p>1980年，德雷弗斯兄弟（Dreyfus Stuart E, Dreyfus, Hubert L) 发表了一篇论文<a href="http://www.dtic.mil/docs/citations/ADA084551">《A Five-Stage Model of the Mental Activities Involved in Directed Skill Acquisition》</a>
(直译：直接技能的获取相关的五阶段精神活动模型），提出了技能成长的五个重要阶段。我在<a href="https://book.douban.com/subject/5372651/">《程序员的思维修炼》</a>这本书中第一次接触到这个模型，感觉茅塞顿开。这个模型套用到其他领域，也非常适用，很好地指导了我在各方面的成长，也让我在新接触新领域的时候，能知道如何更快提升自己。所以我决定把这个模型分享给更多的人。</p>

<p>好了，我们先来看看这个模型。</p>

<h3>I. 新手</h3>

<p>新手需要指令才能工作。这个指令需要明确地指导他，遇到情况 A 如何应对，遇到情况 B 又如何应对。比如煎荷包蛋时，加多少油，什么时候放鸡蛋。</p>

<p>新手和专家之间沟通比较困难。新手描述事情的方式往往简单，缺乏必要的信息，专家不敢轻易下结论；而专家给的建议往往是考虑全面，涉及了不同的情境，并且会给出更底层的原则，而这种原则容易让新手忽略情境盲目遵从，或者无法在需要的时候想起来。</p>

<h3>II. 高级新手</h3>

<p>不愿全盘思考。统计资料显示，多数人落在这个层级;当管理阶层分配工作给高级新手，他们认为每项工作一样重要，不明了优先层度，意味着他们无法认知每件工作的相关性。因此管理者认清，工作需给高级新手时，必须排列优先级。</p>

<p>高级新手已经脱离手册的帮助，能够独立完成项目了。但还缺乏全局观，表现为：不知道为什么要这样做，背后的原因是什么（知识广度和深度都不支持自己得出答案）；也不知道这件事在全局中的意义，如这个项目在公司的战略意义，对用户又能提供什么价值。</p>

<p>另外，高级新手还只能解决已经解决过的问题，对于自己没有遇到过的问题，他们还是一筹莫展，通常他们会询问专家。</p>

<h3>III. 胜任者</h3>

<p>能解决问题，不管是已经解决过的，还是首次遇到的。他们知道在哪里能得到需要的信息。</p>

<h3>IV. 精通者</h3>

<ul>
<li>技能上：<strong>反思</strong> &mdash; 能认知自己的技能与他人差异，能透过观察别人去认知自己的错误,形成比新手更快的学习速度。</li>
<li>职位上：<strong>全局观</strong> &mdash; 能明确知道自己的职位在整体系统上的位。</li>
</ul>


<p>反思的特征让人的技能提升开始加速。所以精通者更接近初级专家，而不是高级胜任者。</p>

<h3>V. 专家</h3>

<p><strong>专家凭直觉工作</strong>。专家是各个领域知识和信息的主要来源。他们总是不断地寻找更好的方法和方式去做事。他们有丰富的经验，可以在恰当的情境中选取和应用这些经验。他们著书、写文章、做巡回演讲。他们是当代的巫师。</p>

<h2>总结</h2>

<p>德雷弗斯技能模型指出了技能水平的不同阶段，不仅仅是知识的差异，更是思维模式的差异。对我来说，我知道了：</p>

<ul>
<li>当我新学习一个技能的时候，应该寻求情景无关的指令，快速入门；</li>
<li>当我已经入门后，需要不断深挖，知道原理；</li>
<li>当我需要进一步提升时，需要通过观察他人，反思自己；</li>
<li>当我想成为专家时，我需要刻意练习，让自己形成直觉。</li>
</ul>


<p>这里引出了 <strong>「刻意练习」</strong> 这个非常重要的概念，他是成为专家的唯一路径。下次我再写一偏，和大家交流刻意练习。</p>

<h2>参考</h2>

<ul>
<li><a href="https://www.youtube.com/watch?v=5SL1A2d2e7M">纪录片 《Miracle of the Hudson River》</a></li>
<li><a href="https://www.youtube.com/watch?v=egf93x4-rvQ">CBS 60 Minutes 采访</a></li>
<li><a href="https://www.zhihu.com/question/50536961/answer/135867633">如何评价电影《萨利机长》 (Sully)？ &ndash; 花痴女王的回答</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%BE%B7%E9%9B%B7%E7%A6%8F%E6%96%AF%E6%A8%A1%E5%9E%8B">维基百科——德雷弗斯模型</a></li>
<li><a href="https://book.douban.com/subject/5372651/">《程序员的思维修炼》</a></li>
<li><a href="https://book.douban.com/subject/26895993/">《刻意练习》</a></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2018-08-10T10:26:44+08:00" pubdate data-updated="true">Aug 10<span>th</span>, 2018</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2017/01/28/ex-doc/">
		
			Elixir 源码阅读笔记: Ex_doc</a>
	</h2>
	<div class="entry-content">
		<p>源码地址：<a href="https://github.com/elixir-lang/ex_doc">https://github.com/elixir-lang/ex_doc</a>
ex_doc 是 elixir 代码生成文档的工具。</p>

<p>生成文档的方式有很多种：</p>

<ol>
<li>利用语法解析分析源码；</li>
<li>利用语言提供的反射能力分析；</li>
</ol>


<p>Elixir 提供的反射功能非常全面，利用 Code 模块提供的一些方法，可以获得目标模块的很多信息。</p>

<p>文档也是其中一种。例如我们有这样的一个模块：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="k">defmodule</span> <span class="no">Example</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'><span class="k">  </span><span class="nv">@moduledoc</span> <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">  Example module for `ex_doc`.</span>
</span><span class='line'>
</span><span class='line'><span class="sd">  ## Examples</span>
</span><span class='line'>
</span><span class='line'><span class="sd">  ``\`</span>
</span><span class='line'><span class="sd">  iex&gt; Example.hello</span>
</span><span class='line'><span class="sd">  :world</span>
</span><span class='line'><span class="sd">  ``\`</span>
</span><span class='line'><span class="sd">  &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">@doc</span> <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">  hello world!</span>
</span><span class='line'><span class="sd">  &quot;&quot;&quot;</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">hello</span> <span class="k">do</span>
</span><span class='line'><span class="k">    </span><span class="ss">:world</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们可以通过 <code>Code.get_docs/2</code> 获得模块的文档。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Code</span><span class="o">.</span><span class="n">get_docs</span> <span class="no">Example</span><span class="p">,</span> <span class="ss">:all</span>
</span><span class='line'><span class="p">[</span><span class="ss">docs:</span> <span class="p">[{</span> <span class="p">{</span><span class="ss">:hello</span><span class="p">,</span> <span class="m">0</span><span class="p">},</span> <span class="m">14</span><span class="p">,</span> <span class="ss">:def</span><span class="p">,</span> <span class="p">[],</span> <span class="s2">&quot;hello world!\n&quot;</span><span class="p">}],</span>
</span><span class='line'> <span class="ss">moduledoc:</span> <span class="p">{</span><span class="m">3</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;Example module for `ex_doc`.\n\n</span><span class="err">##</span><span class="s2"> Examples\n\n```\niex&gt; Example.hello\n:world\n```\n&quot;</span><span class="p">},</span>
</span><span class='line'> <span class="ss">callback_docs:</span> <span class="p">[],</span> <span class="ss">type_docs:</span> <span class="p">[]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到，Elixir 已经在模块的信息中保存了相关的文档信息。ExDoc 接下来做的是提取出来，并进行格式转换。其中用到非常多的反射的接口，大部分都在 <code>Code</code> 模块中提供了。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-01-28T10:03:00+08:00" pubdate data-updated="true">Jan 28<span>th</span>, 2017</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2017/01/17/daily-reading-1/">
		
			Daily Reading Note #1</a>
	</h2>
	<div class="entry-content">
		<p>这里记录了每天阅读代码记录的新知识。</p>

<h3>List.keymember?/3</h3>

<p>用来检查 Keyword List 中有没有对应的 key / value：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="no">List</span><span class="o">.</span><span class="n">keymember?</span><span class="p">([</span><span class="ss">a:</span> <span class="m">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="m">2</span><span class="p">],</span> <span class="ss">:a</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'><span class="no">true</span>
</span><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="no">List</span><span class="o">.</span><span class="n">keymember?</span><span class="p">([</span><span class="ss">a:</span> <span class="m">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="m">2</span><span class="p">],</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
</span><span class='line'><span class="no">true</span>
</span><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="no">List</span><span class="o">.</span><span class="n">keymember?</span><span class="p">([</span><span class="ss">a:</span> <span class="m">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="m">2</span><span class="p">],</span> <span class="ss">:c</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'><span class="no">false</span>
</span></code></pre></td></tr></table></div></figure>


<h3>:code.where_is_file/1</h3>

<p>可以从 load_paths 中找到 beam 文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="ss">:code</span><span class="o">.</span><span class="n">where_is_file</span><span class="p">(</span><span class="s1">&#39;Elixir.Kernel.beam&#39;</span><span class="p">)</span>
</span><span class='line'><span class="s1">&#39;/usr/local/bin/../lib/elixir/ebin/Elixir.Kernel.beam&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Code.prepend_path/1</h3>

<p>将一个路径加入 Elixir 的 load_paths</p>

<h3>Code.eval_string/3</h3>

<p>执行一段代码，并返回结果，以及结果 binding</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Code</span><span class="o">.</span><span class="n">eval_string</span> <span class="s2">&quot;b = a + 1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="ss">a:</span> <span class="m">1</span><span class="p">],</span> <span class="ss">file:</span> <span class="n">__ENV__</span><span class="o">.</span><span class="n">file</span><span class="p">,</span> <span class="ss">line:</span> <span class="n">__ENV__</span><span class="o">.</span><span class="n">line</span>
</span><span class='line'><span class="p">{</span><span class="m">2</span><span class="p">,</span> <span class="p">[</span><span class="ss">a:</span> <span class="m">1</span><span class="p">,</span> <span class="ss">b:</span> <span class="m">2</span><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Keyword.get_values/2</h3>

<p>获取关键字列表中某个 key 对应的所有值，很适合用来获取参数</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Keyword</span><span class="o">.</span><span class="n">get_values</span> <span class="p">[</span><span class="ss">path:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="ss">path:</span> <span class="s2">&quot;b/c&quot;</span><span class="p">],</span> <span class="ss">:path</span>
</span><span class='line'><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b/c&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>:binary.last/1<code>或</code>String.last/1</h3>

<p>获取字符串的最后一个字符</p>

<h3>Kernel.struct/2</h3>

<p>适合留下 struct 合法的 key，丢弃不合法的 key</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="k">defmodule</span> <span class="no">User</span> <span class="k">do</span>
</span><span class='line'><span class="o">...&gt;</span>  <span class="n">defstruct</span> <span class="ss">name:</span> <span class="no">nil</span>
</span><span class='line'><span class="o">...&gt;</span> <span class="k">end</span>
</span><span class='line'><span class="o">...&gt;</span> <span class="n">struct</span> <span class="err">%</span><span class="no">User</span><span class="p">{</span><span class="ss">name:</span> <span class="s2">&quot;qhwa&quot;</span><span class="p">},</span> <span class="err">%</span><span class="p">{</span><span class="ss">name:</span> <span class="s2">&quot;Billy&quot;</span><span class="p">,</span> <span class="ss">age:</span> <span class="m">10</span><span class="p">}</span>
</span><span class='line'><span class="err">%</span><span class="no">User</span><span class="p">{</span><span class="ss">name:</span> <span class="s2">&quot;Billy&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Code.ensure_loaded?/1</h3>

<p>可以判断一个 Module 是否已经加载进来了</p>

<h3>Path.wildcard/1</h3>

<p>等于 Ruby 的 <code>Dir.glob</code></p>

<h3>Path.basename/2</h3>

<p>和 Ruby 一样，可以用来去掉扩展名</p>

<h3>Kernel.function_exported?/3</h3>

<p>判断一个模块是否暴露了方法名</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="n">function_exported?</span> <span class="no">Kernel</span><span class="p">,</span> <span class="ss">:struct</span><span class="p">,</span> <span class="m">2</span>
</span><span class='line'><span class="no">true</span>
</span></code></pre></td></tr></table></div></figure>


<h3><code>Code.get_docs/2</code></h3>

<p>如果编译时有 <code>--docs</code> 选项（默认是有的），可以从模块中得到文档。返回 <code>{line, text}</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Code</span><span class="o">.</span><span class="n">get_docs</span> <span class="no">Code</span><span class="p">,</span> <span class="ss">:moduledoc</span>
</span><span class='line'><span class="p">{</span><span class="m">2</span><span class="p">,</span>
</span><span class='line'> <span class="s2">&quot;Utilities for managing code compilation, code evaluation and code loading.\n\nThis module complements Erlang&#39;s [`:code` module](http://www.erlang.org/doc/man/code.html)\nto add behaviour which is specific to Elixir. Almost all of the functions in this module\nhave global side effects on the behaviour of Elixir.\n&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Enum.at/1</h3>

<h3>module.<strong>info</strong>(:compile)</h3>

<p>能获取一些编译信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Code</span><span class="o">.</span><span class="n">__info__</span><span class="p">(</span><span class="ss">:compile</span><span class="p">)</span>
</span><span class='line'><span class="p">[</span><span class="ss">options:</span> <span class="p">[</span><span class="ss">:debug_info</span><span class="p">],</span> <span class="ss">version:</span> <span class="s1">&#39;6.0.1&#39;</span><span class="p">,</span> <span class="ss">time:</span> <span class="p">{</span><span class="m">2017</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">33</span><span class="p">,</span> <span class="m">52</span><span class="p">},</span>
</span><span class='line'> <span class="ss">source:</span> <span class="s1">&#39;/Users/jose/OSS/elixir/lib/elixir/lib/code.ex&#39;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Kernel.Typespec.beam_specs/1</h3>

<p>可以获取一个模块的类型信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">iex</span><span class="o">&gt;</span> <span class="no">Kernel</span><span class="o">.</span><span class="no">Typespec</span><span class="o">.</span><span class="n">beam_specs</span><span class="p">(</span><span class="no">Code</span><span class="p">)</span>
</span><span class='line'> <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<h3>如何在管道中用 <code>||</code></h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">a</span> <span class="o">|&gt;</span> <span class="n">func</span><span class="p">()</span> <span class="o">|&gt;</span> <span class="no">Kernel</span><span class="o">.||</span><span class="p">([])</span> <span class="o">|&gt;</span> <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-01-17T23:16:40+08:00" pubdate data-updated="true">Jan 17<span>th</span>, 2017</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/09/17/mooncake/">
		
			也谈谈月饼事件</a>
	</h2>
	<div class="entry-content">
		<p><img src="http://www.zaobao.com.sg/sites/default/files/styles/article_large_full/public/images/201609/20160914/809.jpg?itok=vyZLXFnr&amp;timestamp=1473817356" alt="mooncake" /></p>

<p>中秋前夕，阿里的月饼事件引爆了圈内网络（<a href="https://www.zhihu.com/question/50600301">事件回顾</a>）。事情从当事人双方的角度来说都有道理：</p>

<ul>
<li>程序员：只是利用技术替代人工抢，和正常点击按钮抢并没有差别。没想到服务器端有程序 bug，可以不停抢。发现问题后没有付款，赶快联系了行政要退还。</li>
<li>HR: 5个人抢了120多盒月饼，过分了。安全部门的职责就是防范「黑灰产」的，怎么能「监守自盗」！(淘宝上有阿里的中秋月饼在售卖）</li>
</ul>


<p>我相信阿里有自己的立场和原则，不会为外界质疑所动，甚至他们 4 小时的复盘结果也是毫无愧谦之意。也有人颇为赞同这种「捍卫价值观」的做法。</p>

<p>但阿里在程序员的心目中一落千丈已经是不争的事实，外界技术人员对阿里的看法更清醒了，阿里不是一家技术驱动的公司，这里没有工程师文化的土壤。甚至连内部的程序员也对事件非常失望。在我印象里，上市之后，阿里对技术「开源」的态度急转而下。阿里已经成为一个竭尽全力避免风险的公司。这无可厚非，几乎没有一家公司像阿里这样拥有巨大的成功而又充满争议。</p>

<p><img src="/images/toy.jpg" alt="toy" /></p>

<p>然而懂点程序的人都能看得出问题所在。</p>

<ul>
<li>假设这5个人，每人只抢了一盒月饼，从性质上来说，还是不是一样的？显然不是，因为明显可以排除拿去售卖 的可能。但从阿里的官方说辞里面，显然是一样的性质：「技术压制」造成不公平，以及利用系统漏洞获利。那这种情况，是不是也开除？</li>
<li><p>对比一下以下情况，你觉得性质上是否有差别：</p>

<ul>
<li>抢到 100 盒月饼，每盒都付款；</li>
<li>抢到 100 盒月饼，每盒都付款，然后进行高价售卖；</li>
<li>抢到 100 盒月饼，但是只买 1 盒，其余的主动退掉。</li>
</ul>
</li>
</ul>


<p>我再举一个真实的发生在我身上的案例。有一次，妹纸和她的小伙伴们想要去一个博物馆看一个很不错的展览，这个展览在她们的行业里是很火爆的，需要在博物馆的网站上抢票，虽然票是免费发放的，但是只能在一个时间后才开放。她们担心到时候人多抢不到票，于是让我帮忙看看。我试了一下，发现时间限制只是在网页前端做的，完全可以绕开。就用几条命令帮她们提前申请到票了。我没有觉得有愧于心，因为：</p>

<ul>
<li>我有机会领到更多的票，高价出售给别人，但我没有；</li>
<li>我可以炫耀给别人，让博物馆因为这个漏洞遭受损失，但我没有；</li>
</ul>


<p>可见，我是有机会成为所谓的「黑灰产」的，但我没有。<strong>如果因为我将来可能会犯错，而将我提前关起来，这个逻辑是不合理的。</strong></p>

<p>以我 7 年多阿里生涯来看，真没看出来抢月饼是不符合哪条价值观了。以未曾发生的事情（安全部成了自我黑灰产）为处理依据，臆断别人的用意；为了达到杀鸡儆猴的效果，做出令人啼笑皆非的处理。这件事情拿不出哪条条例，连价值观的说法也难以服众。还说不是处罚太重？这恐怕是本年度程序员最被误解的事情了吧？</p>

<p>从阿里离职以来，本着价值观「随时随地维护公司形象」，我从未说过阿里什么坏话，但这件事情让我太看不下去了，看不下去程序员被如此误解，如此对待。</p>

<p>只想表达一个观点：这件事情的处理是不懂程序员的阿里管理层犯下的一个错误，但会有什么影响，历史会告诉我们。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-09-17T12:50:44+08:00" pubdate data-updated="true">Sep 17<span>th</span>, 2016</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/05/05/minifying-with-webpack/">
		
			Minifying-with-webpack</a>
	</h2>
	<div class="entry-content">
		<p><img src="https://cdn-images-1.medium.com/max/1600/1*rsOjd1jR3eOmJNJh4Zp42g.png" alt="webpack bundling" /></p>

<p>When coding in a modern modular way with Webpack is done, it enters the deploy phrase. We minify assets to reduce the network transfer cost. While bundling is not necessary nowadays thanks to HTTP/2, minifying is still an important work, because in many cases we can reduce the size to transfer between servers and clients:</p>

<ul>
<li>unreachable codes can be removed</li>
<li>comments code can be removed</li>
<li>images can be optimised losslessly</li>
<li>variable names can be shortened in Javascript</li>
<li>HTML and SVGs can be optimised</li>
</ul>


<p>Here in <a href="http://www.helijia.com">Helijia</a>, we use webpack to build mobile apps. Here are some notes from us on minifying with <a href="https://webpack.github.io">Webpack</a>.</p>

<h2>Minifying Javascript / CSS</h2>

<p><a href="https://webpack.github.io">Webpack</a> is shipped with some builtin plugins which can do the job well.
* <a href="https://webpack.github.io/docs/list-of-plugins.html#dedupeplugin">Dedupe Plugin</a> searches for similar files and deduplicated them in the output.
* <a href="https://webpack.github.io/docs/list-of-plugins.html#uglifyjsplugin">UglyfiJS Plugin</a> uses the famous <a href="https://github.com/mishoo/UglifyJS">UglifyJS</a> to minify JS and CSS assets.</p>

<h3>Tip: Use webpack stats to review your modules</h3>

<p>Webpack can generate packing stats in json format while packing. We use <a href="https://chrisbateman.github.io/webpack-visualizer/">Webpack visualizer</a> to visualize it to find which part of our works can be optimized. It helps a lot by providing an detail view inside the bundled file.</p>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*fNQylMzJclEm5VDbVuHwVQ.png" alt="webpack viz" /></p>

<h2>Minifying HTML</h2>

<p><a href="https://github.com/ampedandwired/html-webpack-plugin">HTML webpack plugin</a> can help minifying HTML. Here is an example config:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">template</span> <span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;../src/template.html.ejs&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">filename</span> <span class="o">:</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">title</span>    <span class="o">:</span> <span class="s1">&#39;河狸家&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">inject</span>   <span class="o">:</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">minify</span>   <span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">html5</span>                          <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">collapseWhitespace</span>             <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">minifyCSS</span>                      <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">minifyJS</span>                       <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">minifyURLs</span>                     <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">removeAttributeQuotes</span>          <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">removeComments</span>                 <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">removeEmptyAttributes</span>          <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">removeOptionalTags</span>             <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">removeRedundantAttributes</span>      <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">removeScriptTypeAttributes</span>     <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">removeStyleLinkTypeAttributese</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">useShortDoctype</span>                <span class="o">:</span> <span class="kc">true</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}),</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Minifying SVG</h2>

<p>we are currently using <a href="https://github.com/rpominov/svgo-loader">svgo-loader</a> to keep SVGs clean.</p>

<p>before:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; standalone=&quot;no&quot;?&gt;</span>
</span><span class='line'><span class="cp">&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot; &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;svg</span> <span class="na">width=</span><span class="s">&quot;100%&quot;</span> <span class="na">height=</span><span class="s">&quot;100%&quot;</span> <span class="na">viewBox=</span><span class="s">&quot;0 0 10 18&quot;</span> <span class="na">version=</span><span class="s">&quot;1.1&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span> <span class="na">style=</span><span class="s">&quot;fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;path</span> <span class="na">id=</span><span class="s">&quot;Shape-Copy&quot;</span> <span class="na">d=</span><span class="s">&quot;M9.157,0.136L0.157,8.636C-0.052,8.834 -0.052,9.166 0.157,9.364L9.157,17.864C9.357,18.053 9.674,18.044 9.864,17.843C10.053,17.643 10.044,17.326 9.843,17.136L1.222,8.994L9.843,0.864C10.044,0.674 10.053,0.357 9.864,0.157C9.674,-0.044 9.357,-0.053 9.157,0.136Z&quot;</span> <span class="na">style=</span><span class="s">&quot;fill:rgb(189,157,98);&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/svg&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>after:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;svg</span> <span class="na">class=</span><span class="s">&quot;SVGInline-svg icon-svg&quot;</span> <span class="na">style=</span><span class="s">&quot;width: 1em;height: 1em;&quot;</span> <span class="na">viewBox=</span><span class="s">&quot;0 0 10 18&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="na">fill-rule=</span><span class="s">&quot;evenodd&quot;</span> <span class="na">clip-rule=</span><span class="s">&quot;evenodd&quot;</span> <span class="na">stroke-linejoin=</span><span class="s">&quot;round&quot;</span> <span class="na">stroke-miterlimit=</span><span class="s">&quot;1.414&quot;</span><span class="nt">&gt;&lt;path</span> <span class="na">d=</span><span class="s">&quot;M9.157.136l-9 8.5a.5.5 0 0 0 0 .728l9 8.5a.5.5 0 0 0 .686-.728l-8.62-8.142 8.62-8.13a.5.5 0 0 0-.686-.728z&quot;</span> <span class="na">fill=</span><span class="s">&quot;#bd9d62&quot;</span><span class="nt">&gt;&lt;/path&gt;&lt;/svg&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Minifying bitmap Images</h2>

<p><a href="https://github.com/tcoopman/image-webpack-loader">Image-webpack-loader</a> can save a lot bandwidth.</p>

<h2>Conclusion</h2>

<p>Webpack provides a powerful way of web developing, we use some plugins to automating the deployment. and there are more out of our view. So let&rsquo;s keep exploring and make web development more enjoyable.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-05-05T10:09:12+08:00" pubdate data-updated="true">May 5<span>th</span>, 2016</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/05/02/shi-yong-yeomankuai-su-da-jian-reactkai-fa-huan-jing/">
		
			Setting Up Your React Project Is Easier Than You Think</a>
	</h2>
	<div class="entry-content">
		<p>I have heard some ones complaining that setting up a <a href="https://webpack.github.io/">Webpack</a> + <a href="https://facebook">React</a> project is not an easy job. It&rsquo;s only partly true. <a href="https://webpack.github.io/">Webpack</a> is not well documented at this moment, and has many powerful features and plugins. This makes configuration on <a href="https://webpack.github.io/">Webpack</a> seem difficult to new developers. To make things even worse, there are tons of &lsquo;starter kit&rsquo; projects over there, most of which are lack of maintainance.</p>

<p><img src="http://yeoman.io/static/yeoman-02.83c46c7213.png" alt="Yeoman" /></p>

<p>Indeed, it is super easy to setup a brand new <a href="https://webpack.github.io/">Webpack</a> + <a href="https://facebook">React</a> project using <a href="http://yeoman.io/">Yeoman</a>.</p>

<p><a href="http://yeoman.io/">Yeoman</a> is a scaffolding tool for web developers. With diffrent <code>generators</code> we can generate different kinds of web projects quickly by lines of command.</p>

<p>Here&rsquo;s how it is done:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># install Yeoman command and generator</span>
</span><span class='line'>npm install -g yo
</span><span class='line'>npm install -g generator-react-webpack
</span><span class='line'>
</span><span class='line'><span class="c"># generate project</span>
</span><span class='line'>mkdir <span class="nb">test</span>-project
</span><span class='line'><span class="nb">cd test</span>-project
</span><span class='line'>yo react-webpack
</span></code></pre></td></tr></table></div></figure>


<p>Thanks to <a href="https://github.com/newtriks/generator-react-webpack">generator-react-webpack</a>, after answering some questions from <code>yo</code> you will get your project setup in seconds.</p>

<p>Easy and quick, right? Here&rsquo;s what we have got out of the box:</p>

<ul>
<li>a project with Webpack and React configured;</li>
<li>a solution for diffrent environments both for runtime and webpack configuration;</li>
<li>a <a href="https://facebook.github.io/flux/">flux</a> project structure;</li>
<li>an optional <a href="http://postcss.org/">PostCSS</a> setup</li>
</ul>


<p>Also this generator can help <a href="https://github.com/newtriks/generator-react-webpack#generating-new-components">generate React components</a> via command line.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-05-02T22:16:08+08:00" pubdate data-updated="true">May 2<span>nd</span>, 2016</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/05/02/why-not-write-any-more/">
		
			为什么写不出博客了</a>
	</h2>
	<div class="entry-content">
		<p>近几年以来，我写博客的数量每况愈下，从几个月一篇，到几个季度一篇，现在已经将近一年一篇了。。 (✖╭╮✖)</p>

<p>今天也是无意间提起，让我思考这个问题</p>

<h2>为什么越来越不写博客了呢？</h2>

<ol>
<li><p>首先想到的是「懒」+「忙」</p>

<p> 但其实「没时间」是一个最不成立的理由，所谓的「没时间」往往是「优先级不高」的幌子罢了。很多时候不忙，心里知道有很多事情应该去做，却什么也不想做。<a href="http://baike.baidu.com/subview/26649/19131821.htm?fromtitle=%E7%8E%8B%E9%98%B3%E6%98%8E&amp;fromid=5710&amp;type=syn">阳明先生</a> 说没有「知易行难」这件事，不「行」是由于「知」得还不彻底。是的，我没有在自己心里把写博客重视起来当一回事，当成一定<strong>非完成不可的</strong>的事情。</p></li>
<li><p>追求的事物已发生了转移?</p>

<p> 是以前对技术更感兴趣一些，现在不感兴趣了吗？似乎也不是，现在每天起来之后也会阅读技术文章。对技术反而比以前更执着了。</p></li>
<li><p>害怕写不好</p>

<p> 以前反而大胆一些，也不怕误导别人；现在反而一些就想写很多，想写一个系列，系统地传授一系列的知识，系统地引导别人掌握一个东西。想做的事情太大，又没有足够的精力去做，于是就这样了。</p></li>
</ol>


<p>原因算是找到了。</p>

<h2>Done better than perfect</h2>

<p>写得差总比不写要好，其实我的 blog 访问量那么低，也误导不了几个人。何况我最近也想明白了，没有所谓的「误导」，每个人都需要有自己的判断力，看到别人的论点需要有甄别的能力。阅读是自己的权利，判断也是自己的义务。坚持推荐我认为「好」的事物，就算因此让别人走了弯路，相信这种弯路也会是一种积累的。</p>

<p>所以我决定，从这篇开始，要多写写一些短小的技术文章了。即便没有人看也没关系，回归当初写 blog 的心境，记录自己的成长。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-05-02T21:41:39+08:00" pubdate data-updated="true">May 2<span>nd</span>, 2016</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/08/09/why-the-limits-config-not-hornored/">
		
			为什么 Limits 不生效</a>
	</h2>
	<div class="entry-content">
		<p>最近遇到一个奇怪的问题，无法将服务器的最大文件打开数量提高。</p>

<p>服务器是 Ubuntu Server 14.04</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$lsb_release</span> -a
</span><span class='line'>No LSB modules are available.
</span><span class='line'>Distributor ID:   Ubuntu
</span><span class='line'>Description:  Ubuntu 14.04.2 LTS
</span><span class='line'>Release:  14.04
</span><span class='line'>Codename: trusty
</span></code></pre></td></tr></table></div></figure>


<p>正常情况下， <code>/etc/security/limits.conf</code> 的改动，应该在下次访问时就生效才对。
但是总是没生效，查了很多资料，尝试了很多修改，终于成功了</p>

<h2>记录一下填的坑：</h2>

<h3>1. 确保 pam 生效</h3>

<p>在 <code>/etc/pam.d/login</code> 中，存在:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>session required pam_limits.so
</span></code></pre></td></tr></table></div></figure>


<h3>2. 确保 ssh 使用 pam</h3>

<p>在 <code>/etc/pam.d/sshd</code> 中，存在:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>session required pam_limits.so
</span></code></pre></td></tr></table></div></figure>


<p>在 <code>/etc/ssh/ssd_config</code> 中, 存在:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>UsePAM yes
</span></code></pre></td></tr></table></div></figure>


<h3>3. limits.conf 建议不要使用星号</h3>

<p>官方 manual 以及网上的教程有很多都用了 <code>*</code> 符号，然而不是所有系统都认的，我最后发现问题就是在这里！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># 不兼容方式:</span>
</span><span class='line'>* soft nofile 51200
</span><span class='line'>* hard nofild 51200
</span><span class='line'>
</span><span class='line'><span class="c"># 兼容方式</span>
</span><span class='line'>root soft nofile 51200
</span><span class='line'>root hard nofile 51200
</span><span class='line'>
</span><span class='line'>qhwa soft nofile 51200
</span><span class='line'>qhwa hard nofile 51200
</span></code></pre></td></tr></table></div></figure>


<h2>如何确认问题之所在</h2>

<h3>查看当前用户的 limits</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">ulimit</span> -a
</span></code></pre></td></tr></table></div></figure>


<h3>查看另外一个用户的 limits</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c"># 注意 ulimit 不是命令，而是 shell 方法</span>
</span><span class='line'>sudo -u &lt;USER&gt; sh -c <span class="s1">&#39;ulimit -a&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>经过 ssh 查看用户的 limits</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>ssh example.com <span class="s1">&#39;ulimit -a&#39;</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-08-09T21:14:35+08:00" pubdate data-updated="true">Aug 9<span>th</span>, 2015</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/02/11/capistrano-deloy-only-to-selected-servers/">
		
			Capistrano-hostmenu: 只操作指定的服务器</a>
	</h2>
	<div class="entry-content">
		<p>想必大家都用过 <a href="http://capistranorb.com/">capistrano</a> 了，部署代码到多个服务器上的神器。
不过使用中有个不太方便的地方是，某些情况下只想部署到其中几台。</p>

<p>例如我们新增了一个功能，但只想找一台服务器先部署上去测试一下，成功后再部署到整个集群。</p>

<p>有好几种方式可以做到：</p>

<ol>
<li>临时修改发布脚本（<code>config/deploy.rb</code> 或 <code>config/deploy/***.rb</code>）</li>
<li>使用 <code>HOST</code> 命令行环境变量，或者 <code>--host</code> 参数, 比如 <code>HOST=example.com cap production deploy</code></li>
</ol>


<p>第1种不好重用，第2种在 <a href="http://capistranorb.com/">capistrano</a> v3.3 以上版本已经失效了。</p>

<p>我把我们项目中用的 task 抽出来做成了一个 gem: <a href="https://github.com/qhwa/capistrano-hostmenu">capistrano-hostmenu</a>
功能实在是太简单，没有什么好描述的。。</p>

<p>一图顶千言：</p>

<p><img src="https://ruby-china-files.b0.upaiyun.com/photo/2015/fd0dc13527ea01a9c5461ddc2b37638a.png" alt="" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-02-11T22:10:44+08:00" pubdate data-updated="true">Feb 11<span>th</span>, 2015</time></div>
	<div class="tags">

</div>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2018

    qhwa

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'qhwa';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-49131235-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>